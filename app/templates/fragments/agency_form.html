<!-- app/templates/fragments/agency_form.html -->
<div class="glass-effect rounded-xl p-6 border border-slate-700/50 max-h-[90vh] overflow-y-auto">
  <div class="flex items-center justify-between mb-6 sticky top-0 bg-slate-800/90 backdrop-blur-sm z-10 py-2 -mt-2">
    <h2 class="text-xl font-bold text-white">
      {{ 'Edit Agency' if agency else 'Add Agency' }}
    </h2>
    <button onclick="closeForm()"
            class="px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded text-sm transition-colors">
      âœ• Cancel
    </button>
  </div>

  <form action="{{ url_for('main.update_agency', agency_id=agency.id) if agency else url_for('agency.add_agency') }}" method="POST" class="space-y-8">
    {{ form.hidden_tag() }}

    <!-- Basic Information Section -->
    <div class="form-section">
      <h3 class="text-lg font-semibold text-white mb-4 flex items-center border-b border-slate-600 pb-2">
        Basic Information
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="md:col-span-1">
          {{ form.name.label(class="block text-sm font-medium text-slate-300 mb-2") }}
          {{ form.name(class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none transition-colors", placeholder="e.g., Metro Transit") }}
          <div class="mt-4">
            <label for="short_name" class="block text-sm font-medium text-slate-300 mb-2">Short Name</label>
            <input type="text" id="short_name" name="short_name" value="{{ agency.short_name if agency else '' }}" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none transition-colors">
          </div>
          {% for error in form.name.errors %}
            <span class="text-red-400 text-xs">{{ error }}</span>
          {% endfor %}
        </div>
        <div class="md:col-span-1">
          {{ form.location.label(class="block text-sm font-medium text-slate-300 mb-2") }}
          {{ form.location(class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none transition-colors", placeholder="e.g., Minneapolis, MN") }}
        </div>
        <div class="md:col-span-2">
          {{ form.description.label(class="block text-sm font-medium text-slate-300 mb-2") }}
          {{ form.description(class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none transition-colors resize-vertical", placeholder="Brief description of the agency and its services") }}
        </div>
        <div class="md:col-span-1">
          {{ form.email_domain.label(class="block text-sm font-medium text-slate-300 mb-2") }}
          {{ form.email_domain(class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none transition-colors", placeholder="e.g., agency.gov or transit.org") }}
          <p class="text-xs text-slate-500 mt-1">Unvalidated text. Use for domain-based access rules.</p>
        </div>
      </div>
    </div>

    <!-- Address & Location Section -->
    <div class="form-section">
      <h3 class="text-lg font-semibold text-white mb-4 flex items-center border-b border-slate-600 pb-2">
        Address & Location
      </h3>
      <div>
        {{ form.address_hq.label(class="block text-sm font-medium text-slate-300 mb-2") }}
        {{ form.address_hq(class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:border-green-500 focus:ring-1 focus:ring-green-500 focus:outline-none transition-colors resize-vertical", placeholder="e.g., 560 6th Ave N, Seattle, WA 98109") }}
        <p class="text-xs text-slate-500 mt-1">Full street address of the main headquarters</p>
      </div>
    </div>

    <!-- Leadership Section -->
    <div class="form-section">
      <h3 class="text-lg font-semibold text-white mb-4 flex items-center border-b border-slate-600 pb-2">
        Leadership
      </h3>
      <div>
        {{ form.ceo.label(class="block text-sm font-medium text-slate-300 mb-2") }}
        {{ form.ceo(class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:border-purple-500 focus:ring-1 focus:ring-purple-500 focus:outline-none transition-colors", placeholder="e.g., John Smith") }}
        <p class="text-xs text-slate-500 mt-1">Current CEO or top executive</p>
      </div>
    </div>

    <!-- Contact Information Section -->
    <div class="form-section">
      <h3 class="text-lg font-semibold text-white mb-4 flex items-center border-b border-slate-600 pb-2">
        Contact Information
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          {{ form.contact_name.label(class="block text-sm font-medium text-slate-300 mb-2") }}
          {{ form.contact_name(class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 focus:outline-none transition-colors", placeholder="e.g., Jane Doe") }}
        </div>
        <div>
          {{ form.contact_email.label(class="block text-sm font-medium text-slate-300 mb-2") }}
          {{ form.contact_email(class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 focus:outline-none transition-colors", placeholder="e.g., contact@agency.gov") }}
        </div>
        <div>
          {{ form.contact_phone.label(class="block text-sm font-medium text-slate-300 mb-2") }}
          {{ form.contact_phone(class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 focus:outline-none transition-colors", placeholder="e.g., (206) 555-0123") }}
        </div>
        <div>
          {{ form.phone_number.label(class="block text-sm font-medium text-slate-300 mb-2") }}
          {{ form.phone_number(class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 focus:outline-none transition-colors", placeholder="e.g., (206) 555-0100") }}
        </div>
      </div>
      <p class="text-xs text-slate-500 mt-2">Primary contact is for direct inquiries, main phone is the public number</p>
    </div>

    <!-- Web & Resources Section -->
    <div class="form-section">
      <h3 class="text-lg font-semibold text-white mb-4 flex items-center border-b border-slate-600 pb-2">
        Web & Resources
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          {{ form.website.label(class="block text-sm font-medium text-slate-300 mb-2") }}
          {{ form.website(class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500 focus:outline-none transition-colors", placeholder="e.g., https://www.agency.gov") }}
          <p class="text-xs text-slate-500 mt-1">Main public website</p>
        </div>
        <div>
          {{ form.transit_map_link.label(class="block text-sm font-medium text-slate-300 mb-2") }}
          {{ form.transit_map_link(class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-400 focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500 focus:outline-none transition-colors", placeholder="e.g., https://www.agency.gov/map") }}
          <p class="text-xs text-slate-500 mt-1">Link to interactive transit map</p>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-section sticky bottom-0 bg-slate-800/95 backdrop-blur-sm border-t border-slate-600 pt-6 mt-8">
      <div class="flex flex-col sm:flex-row gap-3">
        <button type="submit" 
                class="flex-1 px-6 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 rounded-lg font-medium hover:from-blue-700 hover:to-cyan-700 transition-all text-white shadow-lg">
          <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
          </svg>
          {{ 'Update Agency' if agency else 'Create Agency' }}
        </button>
        <button type="button" onclick="closeForm()" 
                class="px-6 py-3 bg-slate-700 hover:bg-slate-600 rounded-lg font-medium transition-colors text-white">
          Cancel
        </button>
      </div>
    </div>
  </form>
</div>
