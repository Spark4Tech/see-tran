<!-- Single AFI row with actions -->
<div class="bg-slate-600/30 rounded-lg p-3" id="afi-{{ impl.id }}">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-1">
    <span class="text-sm font-medium text-white mb-1 sm:mb-0">{{ impl.function.name }}</span>
    <div class="flex items-center space-x-2">
      <span class="text-xs text-slate-400 bg-slate-700 px-2 py-1 rounded">
        {{ impl.function.functional_area.name }}
      </span>
      <form hx-post="/api/implementations/{{ impl.id }}/status" hx-target="#afi-{{ impl.id }}" hx-swap="outerHTML" class="inline">
        <select name="status" class="text-xs bg-slate-700/70 text-slate-200 rounded px-1 py-0.5">
          {% for s in ['Active','Planned','Retired'] %}
            <option value="{{ s }}" {% if impl.status == s %}selected{% endif %}>{{ s }}</option>
          {% endfor %}
        </select>
      </form>
      <button hx-get="/api/implementations/{{ impl.id }}/edit" hx-target="#afi-{{ impl.id }}" hx-swap="outerHTML"
              class="text-xs px-2 py-1 bg-blue-600/60 hover:bg-blue-600 rounded">Edit</button>
      <button hx-delete="/api/implementations/{{ impl.id }}" hx-target="#afi-{{ impl.id }}" hx-swap="outerHTML"
              class="text-xs px-2 py-1 bg-red-600/60 hover:bg-red-600 rounded">Delete</button>
      <button hx-get="/api/implementations/{{ impl.id }}/history" hx-target="#afi-{{ impl.id }}-history" hx-swap="innerHTML"
              class="text-xs px-2 py-1 bg-slate-700/60 hover:bg-slate-700 rounded">History</button>
    </div>
  </div>
  <div class="text-xs text-slate-400 flex items-center justify-between">
    <span>Component: {{ impl.component.name }}{% if impl.parent_afi_id %} <span class="text-slate-500">(child)</span>{% elif impl.child_afis %} <span class="text-blue-400">(composite)</span>{% endif %}</span>
    <span>
      {% if impl.deployment_date %}Deployed: {{ impl.deployment_date.strftime('%Y-%m-%d') }} • {% endif %}
      {% if impl.version %}v{{ impl.version }}{% endif %}
    </span>
  </div>
  {% if impl.child_afis %}
    <div class="mt-2 ml-4 space-y-1">
      {% for child in impl.child_afis %}
        <div class="flex items-center justify-between text-xs text-slate-300 bg-slate-700/30 rounded px-2 py-1" id="afi-{{ child.id }}">
          <div>
            • {{ child.component.name }}
          </div>
          <div class="flex items-center gap-2">
            <span class="text-slate-500">{{ child.status }}</span>
            <button hx-delete="/api/implementations/{{ impl.id }}/child/{{ child.id }}" hx-target="#afi-{{ impl.id }}" hx-swap="outerHTML"
                    class="px-2 py-0.5 bg-red-700/60 hover:bg-red-700 rounded">Remove</button>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
  <div id="afi-{{ impl.id }}-history" class="mt-2"></div>
</div>
<div class="text-xs text-red-400 p-2 border border-red-600/40 rounded bg-red-900/20">
  AFI row deprecated. Update templates to use configuration_row.html.
</div>
