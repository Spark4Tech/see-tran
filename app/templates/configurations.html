{% extends 'base.html' %}
{% block content %}
<div class="px-6 py-6">
  <h1 class="text-2xl font-bold text-white mb-4">Configurations</h1>
  <div class="flex flex-col md:flex-row md:items-center md:space-x-4 gap-2 mb-4">
    <select id="filter-agency" name="agency_id" class="bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-slate-200"
            hx-get="/api/configurations/list" hx-target="#config-list" hx-include="#filter-agency,#filter-function,#filter-status">
      <option value="">All Agencies</option>
      {% for a in agencies %}
      <option value="{{ a.id }}" {% if selected_agency_id and a.id == selected_agency_id %}selected{% endif %}>{{ a.name }}</option>
      {% endfor %}
    </select>
    <div class="flex items-center gap-2">
      <input id="filter-function-search" name="q" type="text" placeholder="Search functions..."
             class="bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-slate-200 w-48"
             hx-get="/api/options/functions" hx-target="#filter-function" hx-trigger="keyup changed delay:300ms"
             hx-include="#filter-function-search">
      <select id="filter-function" name="function_id" class="bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-slate-200"
              hx-get="/api/configurations/list" hx-target="#config-list" hx-include="#filter-agency,#filter-function,#filter-status">
        <option value="">All Functions</option>
        {% for f in functions %}
        <option value="{{ f.id }}">{{ f.name }}</option>
        {% endfor %}
      </select>
    </div>
    <select id="filter-status" name="status" class="bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-slate-200"
            hx-get="/api/configurations/list" hx-target="#config-list" hx-include="#filter-agency,#filter-function,#filter-status">
      <option value="">All Statuses</option>
      <option value="Active">Active</option>
      <option value="Planned">Planned</option>
      <option value="Retired">Retired</option>
      <option value="Draft">Draft</option>
    </select>
  </div>
  <div id="config-list" hx-get="/api/configurations/list" hx-trigger="load">
    <div class="text-slate-500 text-sm">Loading...</div>
  </div>
  <div id="configuration-details" class="mt-4"></div>
  <div class="mt-8">
    <h2 class="text-xl text-white font-semibold mb-2">Quick Create</h2>
    <form hx-post="/api/configurations" hx-target="#config-list" hx-swap="beforebegin" class="space-y-3">
      {% if selected_agency_id %}
        <input type="hidden" name="agency_id" value="{{ selected_agency_id }}" />
        <div class="text-xs text-slate-400">Agency preselected.</div>
      {% else %}
        <div>
          <label class="block text-xs text-slate-400 mb-1">Agency</label>
          <select name="agency_id" class="bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-slate-200 w-full">
            {% for a in agencies %}<option value="{{ a.id }}">{{ a.name }}</option>{% endfor %}
          </select>
        </div>
      {% endif %}

      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div>
          <label class="block text-xs text-slate-400 mb-1">Functional Area</label>
          <select id="qc-fa"
                  class="bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-slate-200 w-full"
                  hx-get="/api/options/functions" hx-target="#qc-function" hx-trigger="change"
                  hx-include="#qc-fa,#qc-function-search">
            <option value="">All Functional Areas</option>
          </select>
        </div>
        <div>
          <label class="block text-xs text-slate-400 mb-1">Search Functions</label>
          <input id="qc-function-search" name="q" type="text" placeholder="Type to search..."
                 class="bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-slate-200 w-full"
                 hx-get="/api/options/functions" hx-target="#qc-function" hx-trigger="keyup changed delay:300ms"
                 hx-include="#qc-fa,#qc-function-search" />
        </div>
        <div>
          <label class="block text-xs text-slate-400 mb-1">Function</label>
          <select id="qc-function" name="function_id" class="bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-slate-200 w-full"
                  hx-get="/api/options/components" hx-target="#qc-component" hx-trigger="change" hx-include="#qc-function">
            <option value="">Select a function</option>
          </select>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div>
          <label class="block text-xs text-slate-400 mb-1">Component</label>
          <select id="qc-component" name="component_id" class="bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-slate-200 w-full">
            <option value="">Select a component</option>
          </select>
        </div>
        <div>
          <label class="block text-xs text-slate-400 mb-1">Status</label>
          <select name="status" class="bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-slate-200 w-full">
            <option value="Active">Active</option>
            <option value="Planned">Planned</option>
            <option value="Retired">Retired</option>
            <option value="Draft">Draft</option>
          </select>
        </div>
      </div>

      <button class="px-3 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded text-sm">Create</button>
    </form>
    <div class="mt-4">
      <h3 class="text-white font-semibold mb-2">Wizard</h3>
      <!-- Populate FA options for Quick Create on load -->
      <div hx-get="/api/options/functional-areas" hx-target="#qc-fa" hx-trigger="load"></div>
      <div id="wizard"
           {% if selected_agency_id %}
             hx-get="/api/wizard/config/step1?agency_id={{ selected_agency_id }}"
           {% else %}
             hx-get="/api/wizard/config/step1"
           {% endif %}
           hx-trigger="load"></div>
    </div>
  </div>
</div>
{% endblock %}
